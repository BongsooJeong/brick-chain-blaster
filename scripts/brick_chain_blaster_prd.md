<context>
# Overview  
Brick Chain Blaster는 고전 벽돌깨기와 현대 캐주얼 게임의 다중 볼 체인 메커니즘을 결합한 퍼즐 아케이드 게임이다. 사용자는 마우스 오버로 조준선을 확인하고 클릭으로 여러 개의 볼을 발사하여 상단에서 내려오는 벽돌을 파괴하며, 벽돌이 화면을 가득 채우기 전에 최대한 높은 웨이브를 달성해야 한다. 짧고 중독성 강한 세션을 원하는 캐주얼 게이머에게 즉각적인 성취감과 장기적인 성장·수집·경쟁 요소를 제공한다.

# Core Features  
- 볼 체인 발사  
  - 무엇을 하나요: 한 번의 조준으로 다수의 볼을 연속 발사한다.  
  - 왜 중요한가요: 대량 타격의 시각적 쾌감과 각도 계산의 전략성을 동시에 제공한다.  
  - 작동 방식: 마우스 오버 시 발사지점에서 커서 방향으로 안내선과 타겟 커서가 표시되고, 그 상태에서 클릭하면 안내선 방향으로 다수의 볼이 순차적으로 발사되어 물리 엔진(탄성 충돌)으로 계산된다.  
- 시원한 볼 애니메이션 & 패스트포워드  
  - 무엇을 하나요: 볼 발사·충돌 애니메이션을 고프레임(120fps 보간)으로 표현하고, 플레이어가 클릭 한 번으로 현재 턴을 4배속으로 빠르게 감상하거나 즉시 결과를 확인할 수 있는 Fast‑Forward 기능을 제공한다.  
  - 왜 중요한가요: 다수의 볼이 높은 HP 벽돌을 오래 때리는 상황에서 발생하는 지루함을 해소하고, 강력한 타격감을 유지한다.  
  - 작동 방식: 볼 이동은 화면 프레임레이트와 분리된 내부 시뮬레이션 타이머로 계산된다. Fast‑Forward 버튼을 누르거나 자동 트리거(20초 이상 경과 & 남은 충돌 수 일정 이상) 발생 시 타이머 TimeScale을 4×로 올려 턴을 단축한다. 진행 막대를 UI 상단에 표시해 남은 시뮬레이션 시간을 시각화하며, 언제든 다시 클릭해 정상 속도로 복귀할 수 있다.  

- 패턴 기반 벽돌 생성  
  - 무엇을 하나요: 턴마다 패턴 라이브러리를 활용해 랜덤·규칙 조합 형태로 벽돌을 배치한다.  
  - 왜 중요한가요: 반복적인 한 줄 추가 방식에서 벗어나 시각적·전략적 다양성을 제공한다.  
  - 작동 방식:  
    1. 웨이브 시작 시 패턴 템플릿(수평 라인, 계단, 피라미드, 십자, 중앙 요새 등) 중 하나를 RNG로 선택한다.  
    2. 선택된 패턴에 좌우 미러링·회전을 적용하여 변형을 만든다.  
    3. 템플릿 좌표 일부를 확률적으로 비워 갭을 만들고, HP를 가중치 분포(가장자리 낮음/중앙 높음)로 설정한다.  
    4. 5웨이브마다 "스웜"(랜덤 흩뿌림), "요새"(고 HP 중앙 집중), "터널"(양측 벽 남기고 중앙 빈 통로) 같은 특수 패턴을 삽입해 리듬을 준다.  

- 벽돌 HP 시스템    
  - 무엇을 하나요: 모든 벽돌은 오직 HP 수치만 가지고 있다.  
  - 왜 중요한가요: 규칙을 단순화해 핵심 재미를 발사 각도·아이템 전략에 집중시킨다.  
  - 작동 방식: 웨이브 인덱스를 기반으로 HP가 기계적으로 증가한다.  
- 아이템 시스템  
  - 개요: 필드에 떠 있는 아이콘을 볼이 통과하면 수집되어 우측 인벤토리에 저장된다. 한 턴에 하나만 사용 가능하며, 사용 후 바로 소모되고 효과는 그 턴 동안만 지속된다.  
  - 아이템 목록  
    - **레이저(관통)**  
      - 효과: 이번 턴에 발사된 모든 볼이 첫 번째 충돌을 무시하고 브릭을 관통한다.  
      - 동작: 활성화 시 볼이 레이저 트레일을 지니고 연속적으로 뒤쪽 브릭까지 데미지를 입힌다.  
    - **트리‑스플릿**  
      - 효과: 각 볼이 첫 브릭 충돌 시 원 볼 포함 3개로 분열(±10°)되어 궤적을 확산한다.  
      - 동작: 충돌 순간 두 개의 추가 볼을 생성하며 동일 데미지를 적용한다.  
    - **시한폭탄 변환**  
      - 효과: 이번 턴 첫 충돌한 브릭을 폭탄으로 변환해 2턴 후 3×3 범위에 대미지를 입힌다.  
      - 동작: 폭탄은 HP 대신 타이머 숫자로 표시되고, 폭발 시 주변 브릭 HP를 0으로 만든다.  
    - **리코쳇 부스터**  
      - 효과: 이번 턴 동안 볼이 벽에 바운스할 때마다 추가 대미지 +1이 누적된다.  
      - 동작: 볼 밝기가 Bounce마다 증가하며 누적 대미지를 시각적으로 표현한다.  
    - **중력 우물**  
      - 효과: 필드 중앙에 1턴 동안 중력 중심을 생성해 볼 궤적을 안쪽으로 휘게 한다.  
      - 동작: 원형 이펙트로 범위를 표시하며 종료 시 물리가 정상화된다.  
    - **바텀 실드**  
      - 효과: 화면 하단에 1턴 동안 보호막을 생성해 브릭이 하단 라인을 넘는 것을 방어한다.  
      - 동작: 보호막은 피격 시 즉시 사라지며 턴 종료 시 자동 해제된다.  
    - **멀티샷**  
      - 효과: 클릭 시 즉시 추가로 5개의 볼을 30° 팬 형태로 발사한다.  
      - 동작: 추가 볼은 기본 볼과 독립된 순서로 이동하고 동일 대미지를 가진다.  
    - **스티키 볼**  
      - 효과: 이번 턴 최초 10개의 볼이 첫 충돌 브릭에 부착되어 턴 종료 시 동시 폭발한다.  
      - 동작: 부착된 볼은 회색으로 표시되고 폭발 시 주변 브릭에 누적 대미지를 준다.  
  - 획득 & 사용 흐름: 아이템 아이콘은 무작위 위치에 일정 확률로 스폰되고, 볼이 이를 통과하면 인벤토리에 저장된다. 플레이어는 한 턴에 하나의 아이템을 클릭해 활성화할 수 있다.  

- 볼 수 증가 메커니즘  
  - 무엇을 하나요: 일정 개수의 벽돌을 파괴할 때마다 자동으로 발사되는 볼 수가 +1된다.  
  - 왜 중요한가요: 플레이가 진행될수록 화력이 꾸준히 상승해 파괴감이 강화된다.  
  - 작동 방식: 누적 파괴 카운터가 임계치에 도달하면 다음 턴부터 영구적으로 볼 수가 증가한다.  

- 라이브 운영 및 수익화  
  - 무엇을 하나요: 광고 리워드, IAP, 시즌 패스 등 수익 모델과 라이브 이벤트를 제공한다.  
  - 왜 중요한가요: 지속적 매출과 신선한 콘텐츠로 서비스 수명을 연장한다.  
  - 작동 방식: 서버 플래그로 이벤트·상품을 제어하고 외부 SDK와 통합한다.  
  - 무엇을 하나요: 광고 리워드, IAP, 시즌 패스 등 수익 모델과 라이브 이벤트를 제공한다.  
  - 왜 중요한가요: 지속적 매출과 신선한 콘텐츠로 서비스 수명을 연장한다.  
  - 작동 방식: 서버 플래그로 이벤트·상품을 제어하고 외부 SDK와 통합한다.  

# User Experience  
- User personas  
  - 캐주얼 통근러: 출퇴근 5분 내 게임, 광고 리워드 적극 활용.  
  - 완벽주의 수집러: 최고 웨이브와 스킨 수집, 시즌 패스 구매 잠재.  
  - 레트로 애호가: 단순 조작과 도전 난이도 선호, 광고 제거 IAP 선호.  
- Key user flows  
  1. 첫 실행 → 30초 튜토리얼 → 첫 웨이브 클리어 → 업그레이드 팝업  
  2. 일반 플레이 루프 → 웨이브 진행 → 광고 리워드 또는 부활 선택  
  3. 게임 오버 → 점수 공유 → 코인 소비 또는 시즌 패스 제안  
- UI/UX considerations  
  - 기본 원칙: **시원시원함 + 심플함**. 화면 정보 밀도는 최소화하고, 볼·벽돌·아이템처럼 역동적 오브젝트는 크고 선명하게 표현한다.  
  - 인터랙션 피드백: 터치·클릭 시 즉각적인 파티클·사운드로 반응하며, 데미지 수치·HP 감소 애니메이션은 과감한 숫자 팝업으로 짧게 노출한다.  
  - HUD 레이아웃: 하단 중앙 발사 버튼, 우측 세로 인벤토리 슬롯, 상단 좌측 웨이브·점수, 상단 우측 Fast‑Forward 버튼. 아이콘은 단색 + 외곽선으로 미니멀하게.  
  - 색상 팔레트: 기본 테마는 **모던 네온(블랙+네온 블루/핑크)**. 대비가 강해 볼과 벽돌이 뚜렷이 구분된다.  
  - 애니메이션 가이드: 0.1초 미만의 Easing‑out 트윈을 사용해 볼·UI 요소가 빠르게 슬라이드/페이드.  
  - 접근성: 색약 모드용 하이 콘트라스트 테마 제공, 모든 중요한 피드백은 색상+형태+텍스트 삼중 표시.  
  
- UI/GUI Concept  
  - 선택된 컨셉: **Modern Cool**  
    - 톤: 다크 배경 + 네온 라인, 클린 폰트(SF Pro, Roboto).  
    - 키 시각: 볼 궤적 글로우 트레일, 벽돌 HP 얇은 고딕 숫자.  
    - 팔레트: 블랙 #0B0B0C, 네온 블루 #1FB6FF, 네온 핑크 #FF4FD8.  
    - 대상 사용자: 15‑35세 캐주얼/코어 게이머.  
  - 추후 스킨 시스템으로 다른 테마를 추가할 수 있지만 기본 경험은 Modern Cool을 기준으로 디자인한다.  
</context>
<PRD>
# Technical Architecture  
- System components  
  - Flutter Web 클라이언트: HTML5 Canvas 및 WebGL 렌더링, IndexedDB 로컬 캐시.  
  - Firebase Backend: Authentication, Cloud Firestore, Cloud Functions, Cloud Storage.  
- Data models  
  - PlayerProfile: uid, wave, coins, premium, settings.  
  - UpgradeState: balls, damage, powerupRate.  
  - RunState(volatile): gridMatrix, activeBalls.  
- APIs and integrations  
  - Firestore 실시간 리스너(player/{uid}), 배치 쓰기.  
  - HTTPS Callable Functions: submitScore, claimReward.  
  - Remote Config로 이벤트 배너와 밸런스 튜닝.  
- Infrastructure requirements  
  - Firebase Hosting(Preview Channels).  
  - GitHub Actions로 main 브랜치 배포, PR마다 스테이징 프리뷰 채널 생성.  

# Development Roadmap  
- Phase 0: 환경 구축  
  - 프로젝트 초기화, 웹 렌더러 설정, Firebase·CI 파이프라인 구성.  
- Phase 1: MVP  
  - 볼 발사, 벽돌 3종, 웨이브 로직, 로컬 상태 저장, 기본 UI.  
- Phase 2: 온라인 확장  
  - Firestore 동기화, 사용자 인증, 리더보드.  
- Phase 3: 메타 및 수익화  
  - 파워업 4종, 상점, 광고 통합, Stripe 결제.  
- Phase 4: 라이브 운영  
  - 퍼즐 팩 모드, 시즌 패스, Remote Config 이벤트.  

# Logical Dependency Chain  
1. 물리 및 입력 엔진  
2. 기본 볼‑벽돌 상호작용  
3. 웨이브·그리드 시스템  
4. UI HUD(조준선, 발사 버튼)  
5. 코인 로직과 업그레이드 뷰  
6. 광고 리워드 통합  
7. 클라우드 세이브 및 리더보드  
8. 모드와 파워업 확장  
9. 시즌 패스 및 라이브 이벤트  

# Risks and Mitigations  
- 저사양 기기 성능 저하  
  - 오브젝트 풀링과 렌더러 최적화로 대응.  
- MVP 범위 과도  
  - 핵심 루프 외 기능을 후속 단계로 분리해 우선순위 재조정.  
- SDK 충돌 및 복잡도 증가  
  - 최소한의 SDK부터 통합하고 샌드박스 브랜치에서 검증 후 병합.  
- 리텐션 부진  
  - 초기 60초 보상·업그레이드 노출, A/B 테스트로 피드백 루프 개선.  

# Appendix  
- 경쟁 레퍼런스: Ballz, Brick Breaker Quest, Holedown.  
- HP 계산식: HP = WaveIndex × BaseMultiplier(5~8).  
- 데이터 표준: JSON+gzip, BigQuery 일별 파티션.  
</PRD>